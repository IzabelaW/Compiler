/**********************************************************************************************************************************************************************************************
                                                                                    SYMBOL MAP
**********************************************************************************************************************************************************************************************/

/*=============================================================================================================================================================================================
                                                                            C++ Libraries & other C++ code
=============================================================================================================================================================================================*/

#ifndef SYMBOLMAP_H
#define SYMBOLMAP_H

using namespace std;
#include <string>
#include <unordered_map>

unordered_map<string,int> symbolMap;
int offset = 10;

/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                       void yyerror(const char* error) - generates errors with number of line
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

void yyerror (const char *error){
    extern int yylineno;
    fprintf(stderr,"Error: line %d: %s\n",yylineno,error);
}

/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                void putSymbol(string name) - puts symbol to symbolMap
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

void putSymbol(string name){
    pair<string,int> symbol (name, offset);
    symbolMap.insert(symbol);
    offset++;
}

/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                            int getSymbol(string name) - return address of symbol by its name
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

int getSymbol(string name){
    return symbolMap.at(name);
}

/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                            bool symbolExists(string name) - checks if symbol was already declared
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

bool symbolExists(string name){
    if (symbolMap.find(name) == symbolMap.end())
        return false;
    else
        return true;
}

/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                void installIdentifier(string symbolName) - puts symbol to symbolMap if it wasn't already declared
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

void installIdentifier(string symbolName){
   if(!symbolExists(symbolName)){
        putSymbol(symbolName);
   }
   else{
        string errorStr = "Zmienna " + symbolName + " jest ju≈º zadeklarowana!";
        const char* error = errorStr.c_str();
        yyerror(error);
   }
}

#endif
